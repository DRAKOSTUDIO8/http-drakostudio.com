<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRAKO STUDIO | Mi Carrito de Pedido</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&family=Lobster&display=swap" rel="stylesheet">
    
    <style>
        /* *******************************************
         * ESTILO DRAKO STUDIO / DARK & NEON
         * *****************************************
         */

        :root {
            --color-primary-neon: #191CB0;    /* Azul Eléctrico */
            --color-secondary-neon: #00FFC2;  /* Verde Aqua Neón */
            --color-dark-bg: #1A1A1A;        /* Fondo muy Oscuro */
            --color-card-bg: #2A2A2A;        /* Fondo de paneles */
            --color-light-text: #F7F7F7;     /* Texto claro */
        }

        body {
            font-family: 'Poppins', sans-serif; 
            background-color: var(--color-dark-bg);
            color: var(--color-light-text);
            margin: 0;
            padding: 0;
            text-align: center;
        }
         .main-content {
            overflow-x: hidden; 
        }
.top-bar {
            background-color: var(--color-secondary-neon);
            color: var(--color-dark-bg);
            text-align: center;
            padding: 5px 0;
            font-weight: 700;
            font-size: 1em;
        }
        
       .main-header {
    /* ANTERIOR: display: flex; justify-content: space-between; */
    
    /* NUEVO: Usamos Grid para forzar el centrado del elemento del medio */
    display: grid;
    /* 1fr: Columna izquierda (expansible) | auto: Columna central (tamaño del contenido) | 1fr: Columna derecha (expansible) */
    grid-template-columns: 1fr auto 1fr;
    
    align-items: center;
    /* ... el resto de estilos se mantiene ... */
}
.main-header .header-icons:last-child {
    justify-content: flex-end;
}
        /* Contenedor de iconos del Header */
        .header-icons {
            display: flex;
            align-items: center;
        }
        
        /* Estilo general de los enlaces/botones del header */
        .header-icons a {
            margin: 0 10px;
            display: flex; 
            transition: transform 0.3s;
        }
        .header-icons a:hover {
            transform: scale(1.1);
        }
        
        .header-icons img {
            width: 80px; 
            height: 80px;
            object-fit: contain;
        }
         .logo-principal {
    /* Usamos justify-self para centrar el logo en su columna 'auto' */
    justify-self: center; 
    margin: 0 20px;
}
        .logo-principal img {
            justify-self: center;
            width: 150px; 
            height: 150px;
            object-fit: contain;
        }

        .product-card h3, 
        .product-card .price, 
        .product-card input, 
        .product-card label {
            display: none !important;
        }

        .product-image {
            width: 100%; 
            height: 100%; 
            object-fit: cover;
            border-radius: 0;
            margin: 0;
            border: none;
        }
        
        .checkout-button {
            background: var(--color-secondary-neon); 
            color: var(--color-dark-bg);
            padding: 15px 35px;
            border: none;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 900;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
            text-transform: uppercase;
            margin-top: 50px;
            box-shadow: 0 0 15px var(--color-secondary-neon);
        }
        .checkout-button:hover {
            background: #33ffdb;
            transform: scale(1.03);
            box-shadow: 0 0 20px #33ffdb;
        }
        
        /* --- Contenedores Principales del Carrito --- */
        .cart-layout {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }
        .cart-items {
            flex-grow: 1;
        }
        .cart-summary {
            flex-basis: 350px;
            background-color: var(--color-card-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        /* Media Query para móvil */
        @media (max-width: 900px) {
            .cart-layout {
                flex-direction: column;
                align-items: stretch;
            }
            .cart-summary {
                flex-basis: auto;
            }
        }

        /* --- Tabla de Productos --- */
        #cartTable {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--color-card-bg);
            border-radius: 10px;
        }
        #cartTable th, #cartTable td {
            padding: 15px;
            border-bottom: 1px solid #333;
            text-align: left;
        }
        #cartTable th {
            color: var(--color-secondary-neon);
            font-weight: 700;
            text-transform: uppercase;
        }
        #cartTable tr:last-child td {
            border-bottom: none;
        }
        
        .empty-cart {
            text-align: center;
            padding: 40px;
            background-color: var(--color-card-bg);
            border-radius: 10px;
            color: #ccc;
        }
        .empty-cart a {
            color: var(--color-secondary-neon);
            text-decoration: none;
            font-weight: 700;
        }

        /* Campos de Cantidad y Botones de Eliminar */
        .quantity-input {
            width: 50px;
            padding: 5px;
            background: var(--color-dark-bg);
            border: 1px solid #333;
            color: var(--color-light-text);
            border-radius: 5px;
            text-align: center;
        }
        .remove-btn {
            background: var(--color-primary-neon);
            color: var(--color-dark-bg);
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            transition: background 0.2s;
        }
        .remove-btn:hover {
            background: #ff4d99;
        }

        /* --- Resumen y Checkout --- */
        .summary-title {
            color: var(--color-primary-neon);
            border-bottom: 2px solid var(--color-primary-neon);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .summary-line {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1em;
        }
        #cartTotal {
            font-size: 1.5em;
            font-weight: 900;
            color: var(--color-secondary-neon);
        }
        
        .checkout-button {
            width: 100%;
            background: var(--color-primary-neon);
            color: var(--color-dark-bg);
            padding: 15px 35px;
            border: none;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 900;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
            text-transform: uppercase;
            margin-top: 30px;
            box-shadow: 0 0 15px var(--color-primary-neon);
        }
        .checkout-button:hover {
            background: #4648c6;
            transform: scale(1.03);
            box-shadow: 0 0 20px #4648c6;
        }
        
        /* --- Estilos del Formulario de Envío --- */
        .shipping-form label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: var(--color-light-text);
            font-weight: 600;
        }
        .shipping-form input, .shipping-form textarea {
            width: 100%;
            padding: 10px;
            background: var(--color-dark-bg);
            border: 1px solid #444;
            color: var(--color-light-text);
            border-radius: 5px;
            box-sizing: border-box; 
            font-family: 'Poppins', sans-serif;
        }
        .shipping-form textarea {
            resize: vertical;
        }
        .input-group {
            display: flex;
            gap: 10px;
        }
        .input-group > div {
            flex: 1;
        }


        /* --- Footer (simplificado) --- */
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 50px;
            border-top: 1px solid #333;
            color: #666;
        }

    </style>
</head>
<body>
    
    <header class="main-header">
        
        <div class="header-icons">
            <a href="nosotros.html">
                <img src="nosotros.png" alt="Nosotros">
            </a>
        </div>
        
        <a href="inicio.html" class="logo-principal">
            <img src="drako.png" alt="Inicio Drako Studio">
        </a>
        
        <div class="header-icons">
            <a href="catalogo.html">
                <img src="catalogo.png" alt="Catálogo">
            </a>
            <a href="personalizado.html">
                <img src="personalizado.png" alt="Personalizados">
            </a>
            <a href="carrito.html">
                <img src="carrito.png" alt="Carrito">
            </a>
        </div>
    </header>
    
    <div class="container">
        <h1>TU CARRO DE COMBATE 🛒</h1>
        
        <div class="cart-layout">
            
            <div class="cart-items">
                <h2>Productos Seleccionados</h2>
                <div id="cartContent">
                    </div>
            </div>
            
            <div class="cart-summary">
                
                <form id="shippingForm" class="shipping-form">
                    <h3 class="summary-title" style="margin-bottom: 25px;">DATOS DE CONTACTO Y ENVÍO</h3>
                    
                    <label for="nombre">NOMBRE COMPLETO *</label>
                    <input type="text" id="nombre" required>

                    <label for="correo">CORREO ELECTRÓNICO *</label>
                    <input type="email" id="correo" required>

                    <label for="calle">CALLE Y NÚMERO *</label>
                    <input type="text" id="calle" required>

                    <div class="input-group">
                        <div>
                            <label for="colonia">COLONIA *</label>
                            <input type="text" id="colonia" required>
                        </div>
                        <div>
                            <label for="cp">CÓDIGO POSTAL *</label>
                            <input type="text" id="cp" required>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <div>
                            <label for="ciudad">CIUDAD *</label>
                            <input type="text" id="ciudad" required>
                        </div>
                        <div>
                            <label for="estado">ESTADO *</label>
                            <input type="text" id="estado" required>
                        </div>
                    </div>

                    <label for="referencia">REFERENCIA (Ej: Color de casa, entre calles)</label>
                    <input type="text" id="referencia">

                    <label for="nota">NOTA ADICIONAL / COMENTARIOS</label>
                    <textarea id="nota" rows="3"></textarea>
                </form>

                <hr style="border-color: #333; margin: 25px 0 15px 0;">
                
                <h3 class="summary-title">RESUMEN DEL PEDIDO</h3>

                <div class="summary-line">
                    <span>Subtotal de Productos:</span>
                    <span id="subtotalDisplay"></span>
                </div>
                <div class="summary-line">
                    <span>Costo de Envío (Est.):</span>
                    <span style="color: var(--color-secondary-neon); font-size: 0.9em;">Se calcula al cotizar</span>
                </div>
                
                <hr style="border-color: #333; margin: 15px 0;">
                
                <div class="summary-line">
                    <strong>TOTAL ESTIMADO:</strong>
                    <strong id="cartTotal"></strong>
                </div>

                <p style="font-size: 0.8em; color: #aaa; margin-top: 20px;">
                    *El precio final puede variar con el costo de envío y opciones de pago.
                </p>

                <button onclick="sendCartToWhatsApp()" class="checkout-button">
                    CONFIRMAR Y COTIZAR (Vía WhatsApp)
                </button>
            </div>
        </div>
        
    </div>

    <footer>
        <p>© 2025 Drako Studio. Impresión 3D con pasión y tecnología.</p>
    </footer>
    
    <script>
        const WHATSAPP_NUMBER = "5219213071961";
        let cart = JSON.parse(localStorage.getItem('drakoCart')) || {};

        // Función principal para cargar y renderizar el carrito
        function renderCart() {
            const cartContent = document.getElementById('cartContent');
            let total = 0;
            
            if (Object.keys(cart).length === 0) {
                cartContent.innerHTML = `
                    <div class="empty-cart">
                        <p>Tu carrito está vacío. ¡Es hora de empezar a crear!</p>
                        <a href="catalogo.html">Explorar Catálogo</a>
                    </div>
                `;
                document.getElementById('subtotalDisplay').textContent = '$0.00 MXN';
                document.getElementById('cartTotal').textContent = '$0.00 MXN';
                return;
            }

            let tableHTML = `
                <table id="cartTable">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Precio Unitario</th>
                            <th>Cantidad</th>
                            <th>Subtotal</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (const name in cart) {
                const item = cart[name];
                const subtotal = item.price * item.quantity;
                total += subtotal;

                tableHTML += `
                    <tr>
                        <td>${name}</td>
                        <td>$${item.price.toFixed(2)} MXN</td>
                        <td>
                            <input type="number" 
                                   value="${item.quantity}" 
                                   min="1" 
                                   class="quantity-input"
                                   data-item-name="${name}"
                                   onchange="updateQuantity(this)">
                        </td>
                        <td>$${subtotal.toFixed(2)} MXN</td>
                        <td>
                            <button class="remove-btn" onclick="removeItem('${name}')">X</button>
                        </td>
                    </tr>
                `;
            }

            tableHTML += `</tbody></table>`;
            cartContent.innerHTML = tableHTML;
            
            // Actualizar el resumen
            document.getElementById('subtotalDisplay').textContent = `$${total.toFixed(2)} MXN`;
            document.getElementById('cartTotal').textContent = `$${total.toFixed(2)} MXN`;
        }
        
        // Función para actualizar la cantidad de un producto
        function updateQuantity(input) {
            const name = input.getAttribute('data-item-name');
            const newQuantity = parseInt(input.value);

            if (newQuantity <= 0 || isNaN(newQuantity)) {
                removeItem(name);
            } else {
                cart[name].quantity = newQuantity;
                localStorage.setItem('drakoCart', JSON.stringify(cart));
                renderCart();
            }
        }

        // Función para eliminar un producto
        function removeItem(name) {
            if (confirm(`¿Estás seguro de que quieres eliminar "${name}" del carrito?`)) {
                delete cart[name];
                localStorage.setItem('drakoCart', JSON.stringify(cart));
                renderCart(); // Volver a renderizar la vista
            }
        }
        
        // Función para obtener los datos del formulario
        function getShippingData() {
            return {
                nombre: document.getElementById('nombre').value,
                correo: document.getElementById('correo').value,
                calle: document.getElementById('calle').value,
                colonia: document.getElementById('colonia').value,
                cp: document.getElementById('cp').value,
                ciudad: document.getElementById('ciudad').value,
                estado: document.getElementById('estado').value,
                referencia: document.getElementById('referencia').value,
                nota: document.getElementById('nota').value
            };
        }
        
        // Función para validar el formulario (campos requeridos)
        function validateForm(data) {
            const requiredFields = ['nombre', 'correo', 'calle', 'colonia', 'cp', 'ciudad', 'estado'];
            
            for (const field of requiredFields) {
                if (!data[field].trim()) {
                    alert(`Por favor, completa el campo obligatorio: ${field.charAt(0).toUpperCase() + field.slice(1)}.`);
                    document.getElementById(field).focus();
                    return false;
                }
            }
            return true;
        }


        // Función para enviar el carrito completo por WhatsApp (AHORA CON DATOS DE ENVÍO)
        function sendCartToWhatsApp() {
            if (Object.keys(cart).length === 0) {
                alert("Tu carrito está vacío. ¡Añade algunos productos primero!");
                return;
            }

            const shippingData = getShippingData();
            
            // 1. Validar que los campos obligatorios estén llenos
            if (!validateForm(shippingData)) {
                return; // Detiene el proceso si la validación falla
            }
            
            let total = 0;
            let itemsList = [];

            for (const name in cart) {
                const item = cart[name];
                const subtotal = item.price * item.quantity;
                total += subtotal;
                itemsList.push(`- ${name} (x${item.quantity}): $${subtotal.toFixed(2)} MXN`);
            }
            
            // 2. Construir la sección de Datos de Envío
            let shippingMessage = "\n\n--- 🚛 DATOS DE ENVÍO ---\n";
            shippingMessage += `👤 Nombre: ${shippingData.nombre}\n`;
            shippingMessage += `📧 Correo: ${shippingData.correo}\n`;
            shippingMessage += `🏠 Dirección: ${shippingData.calle}, ${shippingData.colonia}, CP ${shippingData.cp}\n`;
            shippingMessage += `📍 Ciudad/Edo: ${shippingData.ciudad}, ${shippingData.estado}\n`;
            if (shippingData.referencia) shippingMessage += `📝 Referencia: ${shippingData.referencia}\n`;
            if (shippingData.nota) shippingMessage += `💬 Nota Adicional: ${shippingData.nota}\n`;


            // 3. Construir el mensaje final de WhatsApp
            let message = "¡Hola Drako Studio! Este es mi pedido final desde la página de Carrito:\n\n";
            message += "--- 📦 PRODUCTOS ---\n";
            message += itemsList.join('\n');
            message += `\nTOTAL (Productos): $${total.toFixed(2)} MXN`;
            message += shippingMessage;
            message += "\n\nPor favor, confirmen el pedido y cotícenme el costo de envío a la dirección proporcionada. ¡Gracias!";


            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`, '_blank');
            
            // Opcional: Limpiar el carrito después de enviar
            // localStorage.removeItem('drakoCart'); 
            // cart = {};
        }

        // Cargar el carrito al iniciar la página
        window.onload = renderCart;

    </script>
</body>
</html>